message(STATUS "zenoh-cpp tests")

add_custom_target(tests)

function(add_test_instance file mode lib)
	get_filename_component(filename ${file} NAME_WE)
	set(target ${mode}_${filename})
	add_executable(${target} EXCLUDE_FROM_ALL ${file})
	add_dependencies(tests ${target})
	add_dependencies(${target} ${lib})
	target_link_libraries(${target} PUBLIC ${lib})
	set_property(TARGET ${target} PROPERTY LANGUAGE CXX)
	set_property(TARGET ${target} PROPERTY CXX_STANDARD 17)
	add_platform_libraries(${target})
	add_test(NAME "test_${target}" COMMAND ${target})
endfunction()

# file(GLOB files "${CMAKE_CURRENT_SOURCE_DIR}/*.cpp")
# foreach(file ${files})
#     add_test_instance(${file} zenohc zenohcpp::zenohc::lib)
#     add_test_instance(${file} zenohpico zenohpico)
# endforeach()

add_test_instance(structs.cpp zenohc zenohcpp::zenohc::lib)
add_test_instance(structs.cpp zenohpico zenohcpp::zenohpico)